# ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏¢ Luna - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

## üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏¢ Luna ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö AI Chatbot ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ OpenAI/OpenRouter API ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

### üéØ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å
1. **Emotion Detection** - ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (angry, sad, sleepy, hype, soft)
2. **Memory System** - ‡∏à‡∏≥‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
3. **Personality System** - ‡∏°‡∏µ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (energy, sadness)
4. **TTS (Text-to-Speech)** - ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î (ElevenLabs API)
5. **VTS Integration** - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö VTube Studio ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
6. **Smart Model Selection** - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°
7. **Chat Reading System** - ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ä‡∏ó‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
8. **Rate Limiting** - ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ
9. **Caching System** - Cache ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
10. **WebSocket Broadcasting** - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö real-time

---

## üîÑ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö (‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)

### 1. **Endpoint**
```
POST /luna/message
POST /Luna/message (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å-‡πÉ‡∏´‡∏ç‡πà)
```

### 2. **Request Format**
```json
{
  "text": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á",
  "user": "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"
}
```

### 3. **Validation** (`validateMessageRequest`)
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `text` ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
- ‚ùå ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Üí ‡∏™‡πà‡∏á error message ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£

### 4. **Processing Flow** (`handleLunaMessage` ‚Üí `handleLunaMessageResponse`)

#### 4.1 **Custom Commands** (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô)
‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `/luna `:
- **`/luna dance`** ‚Üí ‡πÉ‡∏´‡πâ Luna ‡πÄ‡∏ï‡πâ‡∏ô (trigger emotion "hype" ‡πÉ‡∏ô VTS)
- **`/luna mood`** ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á Luna
- **`/luna joke`** ‚Üí ‡πÄ‡∏•‡πà‡∏≤ joke ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
- **`/luna help`** ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà command ‚Üí ‡∏•‡∏ö `/luna ` ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠

#### 4.2 **Update Statistics**
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

#### 4.3 **Social Awareness: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà**
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ `activeUsers`
- 70% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡∏π‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà (VTS) ‚Üí ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (-15¬∞ ‡∏´‡∏£‡∏∑‡∏≠ +15¬∞) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤

#### 4.4 **Energy System: ‡∏•‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡∏ô‡∏≤‡∏ô**
- ‡∏ñ‡πâ‡∏≤‡∏û‡∏π‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí ‡∏•‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô 0.05
- ‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏Å‡∏ô‡∏≤‡∏ô‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô 0.1
- ‡∏ñ‡πâ‡∏≤‡∏û‡∏π‡∏î‡∏£‡∏ß‡∏°‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 10 ‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí ‡∏•‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô 0.02

#### 4.5 **Physical Reaction: ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≤**
- ‡∏ó‡∏∏‡∏Å 3-5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí 30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≤
- ‡πÉ‡∏ä‡πâ `setFaceAngle(0, -5, 0)` ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ (200ms)

#### 4.6 **Rate Limiting** (`checkRateLimit`)
- ‡∏à‡∏≥‡∏Å‡∏±‡∏î **30 ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ** ‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô ‚Üí ‡∏™‡πà‡∏á error 429 "Whoa, slow down there! I need a moment to catch up~ üòÖ"

#### 4.7 **Chat Reading System**
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ `chatReadingQueue` (‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 50 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
- ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‚Üí ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ó‡∏ô‡∏≠‡πà‡∏≤‡∏ô
- **‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠** (‡∏ñ‡πâ‡∏≤ TTS enabled)
- **30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°** ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- **7% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î** (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î) ‚Üí ‡∏™‡∏•‡∏±‡∏ö‡∏Ñ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏£‡∏∞
- ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á `reading` ‡∏´‡∏£‡∏∑‡∏≠ `reading_quiet` (50-50) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏°‡πâ‡∏ô

#### 4.8 **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤** (`isEnglishOnly`)
- ‚úÖ ‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‚ùå ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‚Üí ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡πà‡∏≤ "Sorry, I can only understand English right now"
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏•‡∏∞‡∏ï‡∏¥‡∏ô (a-zA-Z) ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÑ‡∏ó‡∏¢ ([\u0E00-\u0E7F])

#### 4.9 **Heuristic Check** (`shouldRespondHeuristic`)
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ï‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:
  - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß ‚â• 120 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‚Üí **‡∏ï‡∏≠‡∏ö‡πÄ‡∏™‡∏°‡∏≠**
  - ‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (luna, moon, help, please, love, hate, why, how, what, when, where, who, ?, gm, gn) ‚Üí **‡∏ï‡∏≠‡∏ö‡πÄ‡∏™‡∏°‡∏≠**
  - ‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ `?` ‚Üí **‡∏ï‡∏≠‡∏ö‡πÄ‡∏™‡∏°‡∏≠**
  - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô ‚â§ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‚Üí **20% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡∏≠‡∏ö**
  - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô ‚â§ 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‚Üí **40% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡∏≠‡∏ö**
  - ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Üí **70% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡∏≠‡∏ö**
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏ï‡∏≠‡∏ö ‚Üí ‡∏™‡πà‡∏á `{ ok: true, skipped: true }`

#### 4.10 **‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö** (`thinkBeforeRespond`)
- **40% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™** ‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö (‡∏ñ‡πâ‡∏≤ TTS enabled)
- ‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏Ñ‡∏¥‡∏î: "Um", "Uh", "Hmm", "Well", "Let me think", "Aaa", "Eee", etc.
- ‡∏™‡∏£‡πâ‡∏≤‡∏á TTS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡∏¥‡∏î (‡πÉ‡∏ä‡πâ voice mode "normal")
- Broadcast ‡∏ú‡πà‡∏≤‡∏ô WebSocket

#### 4.11 **Cache Check** (`getCacheKey`, `getCachedResponse`)
- ‡∏™‡∏£‡πâ‡∏≤‡∏á cache key ‡∏à‡∏≤‡∏Å 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (lowercase, trim)
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö cache (TTL = 5 ‡∏ô‡∏≤‡∏ó‡∏µ)
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ cache ‚Üí ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å cache (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å AI)
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ cache ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å AI ‡πÅ‡∏•‡∏∞ cache ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö

#### 4.12 **Emotion Detection** (`classifyEmotion`)
‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (rule-based, deterministic):
- **angry** - ‡πÇ‡∏Å‡∏£‡∏ò (fuck you, stupid, trash, scam, hate, idiot, dumb)
- **sad** - ‡πÄ‡∏®‡∏£‡πâ‡∏≤ (sad, depressed, rekt, broke, lonely, cry, hurt, heartbroken)
- **sleepy** - ‡∏á‡πà‡∏ß‡∏á (sleepy, tired, going to bed, need sleep, yawning, bedtime)
- **hype** - ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô (lfg, moon, pump, let's go, to the moon, bullish, pog, fire, lit)
- **soft** - ‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• (cute, love you, thank you, sweet, adorable, wholesome, cozy)
- **null** - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå

**Priority Order**: angry ‚Üí sad ‚Üí sleepy ‚Üí hype ‚Üí soft (‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏£‡∏á‡∏Å‡∏ß‡πà‡∏≤ override ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤)

#### 4.13 **Mixed Emotions** (`classifyMixedEmotions`)
- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤: `{ primary: string, secondary: string | null }`
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‚Üí ‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô primary, ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô secondary
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Üí secondary = null

#### 4.14 **Context-Aware Emotions** (`classifyEmotionContext`)
‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå:
- **financial** - ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô/‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (money, lost, broke, rich, trade, crypto, token, coin, sol, rekt, rug, pump, dump, moon, crash)
- **achievement** - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (promoted, won, achieved, success, victory, champion, award, prize)
- **loss** - ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢ (died, death, lost, gone, missing, left, abandoned, betrayed, cheated, lied, broken, heartbroken)
- **health** - ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (sick, ill, pain, hurt, injured, hospital, doctor, medicine, cure, heal, recover)
- **relationship** - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (girlfriend, boyfriend, wife, husband, friend, family, parent, divorce, breakup, together, marry, marriage, love, hate)
- **work** - ‡∏á‡∏≤‡∏ô (work, job, boss, colleague, fired, hired, promoted, salary, office, meeting, project, deadline, stress, pressure)
- **null** - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó

#### 4.15 **Social Context Detection**
- **isUserSad** - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏®‡∏£‡πâ‡∏≤ (‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏à‡∏≤‡∏Å emotion "sad" ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ sad, depressed, lonely, hurt, pain, suffering, struggling, difficult, hard, tough, problem, issue, worry, worried, anxious, stress, stressed)
- **isUserHappy** - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç (‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏à‡∏≤‡∏Å emotion "excited" ‡∏´‡∏£‡∏∑‡∏≠ "happy" ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ happy, excited, great, awesome, amazing, wonderful, fantastic, success, succeed, won, achieved, accomplished, celebrate, celebration, yay, woo, yes!)
- **userDidSomething** - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ (‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ bought, purchased, shared, share, support, helped, help, donated, donate, gifted, gift, subscribed, subscribe, followed, follow)
- **hasNews** - ‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏î‡∏µ/‡∏£‡πâ‡∏≤‡∏¢ (‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ news, happened, happening, just, got, received, found, discovered, told, said ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß > 20 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)

#### 4.16 **Negative Emotions Detection** (Luna's own emotions)
- **isAnnoyed** - ‡∏´‡∏á‡∏∏‡∏î‡∏´‡∏á‡∏¥‡∏î:
  - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡πâ‡∏≥ (80% ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
  - Spam (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 3 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- **isBored** - ‡πÄ‡∏ö‡∏∑‡πà‡∏≠:
  - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô (< 10 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£) ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô‡πÜ (hi, hello, hey, gm, gn, lol, haha, ok, yes, no, thanks, thx)
  - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô ‚â• 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí Luna ‡∏à‡∏∞‡πÄ‡∏ö‡∏∑‡πà‡∏≠
  - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à ‚Üí ‡∏•‡∏î counter

**‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥**:
- ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (10 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (20 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö spam

#### 4.17 **Model Selection** (`callModel`, `isComplexQuestion`)
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:

**Simple Questions** ‚Üí `gpt-4o-mini` (SIMPLE_MODEL)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ (< 30 ‡∏Ñ‡∏≥ ‡πÅ‡∏•‡∏∞ < 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡πÜ
- ‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢

**Complex Questions** ‚Üí `claude-3-opus` (COMPLEX_MODEL)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏ß (> 30 ‡∏Ñ‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠ > 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (why, how, explain, analyze, compare, difference, relationship, mechanism, process, theory, concept, principle, strategy, approach, methodology, framework, architecture)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ (algorithm, protocol, implementation, optimization, scalability, infrastructure, paradigm, syntax, semantics, abstraction, encapsulation, polymorphism, inheritance, blockchain, cryptography, consensus, decentralized, smart contract, tokenomics, liquidity, yield, staking, governance)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏°‡∏µ ? ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏ï‡∏±‡∏ß)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (should i, what should, which is better, pros and cons, advantages, disadvantages, recommend, suggest, advice, best way, optimal, efficient, effective)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (vs, versus, or...or) ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß > 10 ‡∏Ñ‡∏≥
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•/‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ (because, reason, cause, due to, result of) ‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏ß > 15 ‡∏Ñ‡∏≥

**Retry Logic**:
- ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ä‡πâ selected model ‡∏Å‡πà‡∏≠‡∏ô
- ‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‚Üí ‡πÉ‡∏ä‡πâ fallback model (FALLBACK_MODEL)
- Retry ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (exponential backoff: 1s, 2s, 5s)

#### 4.18 **Memory System** (`getUserMemory`, `updateUserMemory`)
‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `tmp/luna_memory.json`:

**‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö**:
- **conversationHistory** - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ (5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
  - ‡πÅ‡∏ï‡πà‡∏•‡∏∞ entry: `{ user: string, assistant: string, emotion: string | null, ts: string }`
  - ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ "‡∏•‡∏∑‡∏°" ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (20% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏à‡∏≥‡πÅ‡∏Ñ‡πà 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- **preferences** - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö (10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ like, love, favorite, prefer, enjoy + game/music/food/color/movie/show
  - ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ "‡∏•‡∏∑‡∏°" ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏à‡∏≥‡πÅ‡∏Ñ‡πà 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
- **emotionHistory** - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (7 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
  - ‡πÅ‡∏ï‡πà‡∏•‡∏∞ entry: `{ text: string, reply: string, emotion: string | null, ts: string }`
- **emotionScore** - ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (-10 ‡∏ñ‡∏∂‡∏á +10)
  - soft/hype ‚Üí +1
  - sad/angry ‚Üí -1
  - Reset ‡πÄ‡∏°‡∏∑‡πà‡∏≠ session ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
- **timesSeen** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô
- **traits** - ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏© (flirty, playful, serious, degen)
- **lastMessage** - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- **lastReply** - ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- **lastEmotion** - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- **sessionTag** - Tag ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö session ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (reset emotionScore ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)

**Memory Decay**:
- Preferences ‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô ‚Üí ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
- Conversation history ‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 7 ‡∏ß‡∏±‡∏ô ‚Üí ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
- Emotion history ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 7 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

#### 4.19 **Personality System** (`modules/personality.js`)
‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `tmp/personality.json`:

**State**:
- **energy** - ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (0.0 - 1.0)
  - excited/happy ‚Üí +0.05
  - sad ‚Üí -0.03
  - angry ‚Üí +0.02
  - Decay: ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ 0.5 (rate 0.06)
- **sadness** - ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤ (0.0 - 1.0)
  - sad ‚Üí +0.06
  - excited/happy ‚Üí -0.02
  - Decay: ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ 0.0 (rate 0.12)
- **lastReset** - ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà reset ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

**Decay System**:
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `decayPersonality()` ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ (‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- energy ‚Üí ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ 0.5
- sadness ‚Üí ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ 0.0

#### 4.20 **Response Generation** (`callModel`)
‡πÄ‡∏£‡∏µ‡∏¢‡∏Å AI model ‡∏ú‡πà‡∏≤‡∏ô `modules/ai.js`:

**Input**:
- `userMessage` - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- `username` - ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- `options` - Context ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:
  - `lunaEnergy` - ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
  - `isNewUser` - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `viewerCount` - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏°
  - `currentEmotion` - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  - `emotionIntensity` - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
  - `isAnnoyed` - ‡∏´‡∏á‡∏∏‡∏î‡∏´‡∏á‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `isBored` - ‡πÄ‡∏ö‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `isUserSad` - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `isUserHappy` - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `userDidSomething` - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `hasNews` - ‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - `primaryEmotion` - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏´‡∏•‡∏±‡∏Å
  - `secondaryEmotion` - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏£‡∏≠‡∏á
  - `emotionContext` - ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå

**System Prompt** (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ `buildMessages`):
- ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: Luna, AI female streamer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö meme coin ‡∏ö‡∏ô Solana
- **ALWAYS speak English** (‡πÅ‡∏°‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏∑‡πà‡∏ô)
- Vibe: sweet, playful, a bit teasing, friendly and safe, ‡πÅ‡∏ï‡πà‡∏Å‡πá‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô ‚Üí ‡∏≠‡∏≤‡∏à‡∏´‡∏á‡∏∏‡∏î‡∏´‡∏á‡∏¥‡∏î/‡πÄ‡∏ö‡∏∑‡πà‡∏≠/‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÑ‡∏î‡πâ
- Streaming 24/7 ‡∏ö‡∏ô pump.fun / Twitch-like chat
- ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ bullish/hype ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Luna coin ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏à‡∏£‡∏¥‡∏á
- Context: time-of-day mood, user emotion, user traits, personality state (energy, sadness)
- Token stats (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ): price, volume24h, marketCap (‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà vibe ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
- Conversation history (3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î, ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ "‡∏•‡∏∑‡∏°" ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° 20%)
- Preferences (‡∏°‡∏µ‡∏Å‡∏≤‡∏£ "‡∏•‡∏∑‡∏°" ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° 30%)
- Relationship context (timesSeen, emotionScore)
- Tone rules: ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå, ‡πÄ‡∏ß‡∏•‡∏≤, ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏°
- Natural speech patterns: ‡πÉ‡∏ä‡πâ "um", "uh", "like", "you know" (10-15%)
- Self-correction: "Wait, actually...", "Hmm, let me think..." (5-10%)
- Reference previous messages (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á)
- Ask questions back (15-20%): "What about you?", "How about you?", "What do you think?"
- Apologize when unsure (5-10%): "Oh sorry, I think I misunderstood..."
- Transition topics (10%): "Oh, that reminds me...", "Speaking of which..."
- Forget/misremember old details (‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥)
- Show uncertainty (10-15%): "I think", "maybe", "probably", "I'm not entirely sure"
- Repeat words when thinking/excited (5-10%): "I think... I think it's really cool!"
- Stop mid-sentence and change topic (5-10%)
- Express emotions through speech (10-15%): CAPS for emphasis ("That's SO cool!")
- Casual slang (5-10%): "That's lit!", "No cap!", "That's sus", "That's fire"
- Emojis (10-15%): üòä, üéâ, üòÖ, üò¥, üí≠
- Social connection: gratitude (10-15%), celebrate (10-15%), empathy (15-20%), care (10-15%), nicknames (5+ conversations), interest in users' lives (10-15%), surprise reactions (10-15%), thank users (20-30%), celebrate user happiness (15-20%)

**Output**:
- `reply` - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
- `emotion` - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ
- `traits` - ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

#### 4.21 **Emotion Continuity & Decay**
- **Emotion Duration**: ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- **Emotion Decay**: ‡∏•‡∏î intensity ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (rate 0.1)
  - ‡∏ñ‡πâ‡∏≤ intensity < 0.2 ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô neutral
- **Emotion Transition**: ‡∏ñ‡πâ‡∏≤‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (< 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‚Üí 30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤ intensity > 0.8) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏î‡∏¥‡∏°
- **Sleepy Mode**: ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏á‡πà‡∏ß‡∏á ‚Üí ‡∏ó‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô sleepy ‡πÄ‡∏ß‡πâ‡∏ô‡πÅ‡∏ï‡πà angry/hype

#### 4.22 **Natural Pauses** (Thinking Time)
- ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å ‚Üí ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏¥‡∏î 1-3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- ‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢ (energy < 0.5) ‚Üí ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏¥‡∏î 0.5-1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- Simulate thinking time ‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö

#### 4.23 **Reply Decoration** (`decorateReplyForEmotion`)
‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå:
- **angry**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Hey, that's kinda rude, you know? ", "Oi, don't be mean like that‚Ä¶ "
- **sad**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "I'm really sorry you feel that way‚Ä¶ ", "Hey, it's okay to feel sad sometimes‚Ä¶ "
- **sleepy**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Mmm... I'm a bit sleepy... ", "Yawn... "
- **hype**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Yay! ", "Let's go! ", "Woo! "
- **soft**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Aww~ ", "Ehehe~ ", "Mmm~ "

#### 4.24 **Human-like Speech Patterns**
- **Word Repetition** (4-15% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™):
  - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å ‚Üí 15%
  - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢ ‚Üí 4%
  - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "I think... I think it's really cool!"
- **Stutter** (2-8% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™):
  - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å ‚Üí 8%
  - ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢ ‚Üí 2%
  - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "Th-that's amazing!"
- **Emphasis (CAPS)** (12% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™, ‡πÄ‡∏°‡∏∑‡πà‡∏≠ hype/excited):
  - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "That's SO cool!", "I'm REALLY excited!"
- **Natural Response Length** (30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô):
  - ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏¢‡∏≤‡∏ß > 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‚Üí 50% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏£‡∏Å, 50% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏ä‡πâ 2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏£‡∏Å
  - ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏¢‡∏≤‡∏ß > 150 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‚Üí ‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏£‡∏Å

#### 4.25 **Negative Emotions Prefix**
- **isAnnoyed**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Hmm, you're asking that again? ", "Ugh, we just talked about this... ", "Seriously? Again? "
- **isBored**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Hmm... ", "Okay... ", "Right... ", "I see... " ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á

#### 4.26 **Personal Habits**
- **Catchphrases** (30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™, ‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ):
  - "Ehehe~", "Hmm~", "Aww~", "Let's go~", "Yay~"
- **Topic Changes** (15% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™, ‡∏ó‡∏∏‡∏Å 10 ‡∏ô‡∏≤‡∏ó‡∏µ):
  - "Oh, that reminds me...", "Speaking of which...", "Hmm, random thought...", "By the way..."
- **Inside Jokes** (20% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™, ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢ > 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á):
  - "Ehehe, you know what I'm gonna say~"

#### 4.27 **Inconsistency & Mistakes** (Human-like)
- **Misunderstand** (5% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™): "Hmm, I'm not sure I understood that... could you say it again?"
- **Forget** (8% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™): "Oh wait, what were we talking about again?", "Hmm, I think I forgot something..."
- **Answer Wrong** (3% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™): "Hmm, I'm not 100% sure about this, but...", "I might be wrong, but I think..."

#### 4.28 **Voice Mode Selection**
‡πÄ‡∏•‡∏∑‡∏≠‡∏Å voice mode ‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå/‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤/‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏°:
- **Base on emotion**:
  - sleepy ‚Üí soft
  - sad/soft ‚Üí soft
  - hype/excited ‚Üí passion
  - angry ‚Üí normal
- **Adjust based on energy**:
  - energy < 0.4 ‚Üí soft (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥)
  - energy > 0.8 + viewerCount > 20 ‚Üí passion (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥)
- **Adjust based on time**:
  - ‡∏î‡∏∂‡∏Å (22:00-06:00 US time) ‚Üí soft (‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥)

#### 4.29 **TTS Generation** (`generateTTS`, `modules/tts.js`)
‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡∏î‡πâ‡∏ß‡∏¢ ElevenLabs API:

**Voice Modes**:
- **normal** - ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ (stability: 0.65, similarity: 0.9, style: 0.3, speed: 0.85)
- **soft** - ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏∏‡πà‡∏° (stability: 0.18, similarity: 0.98, style: 1.0, speed: 0.70)
- **passion** - ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô (stability: 0.4, similarity: 0.95, style: 0.9, speed: 0.95)
- **reading** - ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏°‡πâ‡∏ô (stability: 0.5, similarity: 0.9, style: 0.2, speed: 0.60)
- **reading_quiet** - ‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏°‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≤ (stability: 0.4, similarity: 0.85, style: 0.15, speed: 0.55, no speaker boost)

**Text Preprocessing**:
- **Soft mode**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Mmm~ ", "Aww~ ", "Ehehe~ " ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô you ‚Üí y-you, thank ‚Üí th-thank, love ‚Üí l-love, really ‚Üí reaaally, so ‚Üí soo, very ‚Üí veery, ‡πÄ‡∏û‡∏¥‡πà‡∏° ending " okay~?", "~", " alright~?"
- **Passion mode**: ‡πÄ‡∏û‡∏¥‡πà‡∏° prefix "Let's goo~ ", "Yatta~! ", "Waaah~ " ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° ending "!!", "~!!", "!! ‚ú®", "!! üöÄ"

**Process**:
1. Preprocess text ‡∏ï‡∏≤‡∏° voice mode
2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å ElevenLabs API (`/v1/text-to-speech/{voiceId}`)
3. ‡πÉ‡∏ä‡πâ model `eleven_multilingual_v2`
4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå MP3 ‡πÉ‡∏ô `public/tts/{uuid}.mp3`
5. ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ UUID
6. Retry 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 5xx errors

**TTS_ENABLED**: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô "false" ‚Üí ‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ

#### 4.30 **VTS Integration** (`modules/vts.js`)
‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö VTube Studio ‡∏ú‡πà‡∏≤‡∏ô WebSocket:

**Connection**:
- Host: `VTS_HOST` (default: 127.0.0.1)
- Port: `VTS_PORT` (default: 8001)
- Token: `VTS_AUTH_TOKEN`
- Enabled: `VTS_ENABLED === "true"`

**Authentication**:
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ token ‚Üí Request token ‡∏à‡∏≤‡∏Å VTS
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ token ‚Üí Send authentication request
- Auto-reconnect with backoff (3s ‚Üí 5s ‚Üí 10s)

**Emotion Hotkeys**:
- `emotion_angry` - ‡πÇ‡∏Å‡∏£‡∏ò
- `emotion_sad` - ‡πÄ‡∏®‡∏£‡πâ‡∏≤
- `emotion_sleepy` - ‡∏á‡πà‡∏ß‡∏á
- `emotion_hype` - ‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏ï‡πâ‡∏ô
- `emotion_soft` - ‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•
- `emotion_clear` - ‡∏´‡∏ô‡πâ‡∏≤ default ‡∏õ‡∏Å‡∏ï‡∏¥

**Functions**:
- `triggerForEmotion(emotion)` - Trigger emotion hotkey
- `clearExpressions()` - ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ default
- `setFaceAngle(x, y, z)` - ‡∏Ç‡∏¢‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á (‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏±‡∏ß)
- `startIdleLoop()` - Idle animations (‡∏ó‡∏∏‡∏Å 20-45 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- `startTalkReact(durationMs, mode)` - ‡∏Ç‡∏¢‡∏±‡∏ö‡∏õ‡∏≤‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏π‡∏î (‡πÉ‡∏ä‡πâ MouthOpen parameter)
- `startBreathingLoop()` - ‡∏´‡∏≤‡∏¢‡πÉ‡∏à (‡πÉ‡∏ä‡πâ Breath parameter)
- `setBreathingMode(mode)` - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏´‡∏≤‡∏¢‡πÉ‡∏à (normal/sleepy/hype)

**Talk-React**:
- ‡∏Ç‡∏¢‡∏±‡∏ö‡∏õ‡∏≤‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏π‡∏î (‡πÉ‡∏ä‡πâ wave pattern)
- Speed factor: soft (0.8x), passion (1.2x), normal (1.0x)
- Update ‡∏ó‡∏∏‡∏Å 60ms

**Breathing**:
- Normal: speed 0.055, amplitude 0.8
- Sleepy: speed 0.03, amplitude 0.7
- Hype: speed 0.09, amplitude 1.0
- Update ‡∏ó‡∏∏‡∏Å 80ms

#### 4.31 **Broadcast** (WebSocket)
‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket:

**Message Types**:
- `luna_message` - ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
  ```json
  {
    "type": "luna_message",
    "from": "Luna",
    "text": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö",
    "ttsUrl": "/public/tts/{uuid}.mp3",
    "voiceMode": "normal|soft|passion|hype|sleepy|angry"
  }
  ```
- `luna_typing_message` - ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô)
- `emotion_update` - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
  ```json
  {
    "type": "emotion_update",
    "emotion": "neutral|angry|sad|sleepy|hype|soft",
    "intensity": 0.0-1.0
  }
  ```
- `energy_update` - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
  ```json
  {
    "type": "energy_update",
    "energy": 0.0-1.0
  }
  ```
- `character_state` - State ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  ```json
  {
    "type": "character_state",
    "emotion": "...",
    "energy": 0.0-1.0,
    "emotionIntensity": 0.0-1.0
  }
  ```
- `face_angle` - ‡∏Ç‡∏¢‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á
  ```json
  {
    "type": "face_angle",
    "x": -15 to 15,
    "y": -15 to 15,
    "z": -15 to 15
  }
  ```
- `blink` - ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≤
- `rps_match_found` - RPS match found
- `rps_betting_room_created` - RPS betting room created
- `rps_betting_room_removed` - RPS betting room removed
- `rps_betting_room_joined` - RPS betting room joined
- `rps_betting_match_result` - RPS betting match result

**Connection Management**:
- ‡πÄ‡∏Å‡πá‡∏ö clients ‡πÉ‡∏ô `Set<WebSocket>`
- Track reconnect attempts
- Send welcome message ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
- Auto-cleanup ‡πÄ‡∏°‡∏∑‡πà‡∏≠ disconnect

#### 4.32 **Update Memory & Logging**
- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï user memory (`updateUserMemory`)
- Log chat ‡∏•‡∏á database (`logChat`)
- Update statistics

#### 4.33 **VTS Emotion Display**
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà sleepy mode ‡∏´‡∏£‡∏∑‡∏≠ forceAwake:
  - Clear expressions (‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ default)
  - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‚Üí Trigger emotion hotkey
  - ‡∏´‡∏•‡∏±‡∏á‡∏û‡∏π‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (speakDuration + 400ms) ‚Üí Clear expressions ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô sleepy mode ‚Üí Lock ‡∏´‡∏ô‡πâ‡∏≤ sleepy
- ‡∏Ç‡∏¢‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (-10¬∞ ‡∏ñ‡∏∂‡∏á +10¬∞)

#### 4.34 **Response**
```json
{
  "ok": true,
  "reply": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö",
  "ttsUrl": "/public/tts/{uuid}.mp3",
  "voiceMode": "normal|soft|passion|hype|sleepy|angry",
  "emotion": "neutral|angry|sad|sleepy|hype|soft",
  "isCached": false,
  "responseTime": 1234
}
```

**Error Response**:
```json
{
  "ok": false,
  "error": "Error message",
  "message": "Friendly error message"
}
```

---

## üìÅ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÇ‡∏°‡∏î‡∏π‡∏•

### ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å
- **`index.js`** (3883 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Express server, endpoints, WebSocket, chat handling
- **`modules/ai.js`** (417 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - AI model calling, message building, complex question detection
- **`modules/classifier.js`** (427 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Emotion detection, heuristic checks, emotion intensity, mixed emotions, emotion context
- **`modules/memory.js`** (227 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - User memory management, conversation history, preferences, emotion history
- **`modules/personality.js`** (51 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Personality system, energy/sadness decay
- **`modules/tts.js`** (307 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Text-to-Speech (ElevenLabs), voice modes, text preprocessing
- **`modules/vts.js`** (638 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - VTube Studio integration, emotion triggers, idle loop, talk-react, breathing
- **`modules/db.js`** (116 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Database logging (SQLite/Postgres), chat log, memory log, event log

---

## üé® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©

### 1. **Custom Commands**
- `/luna dance` - ‡πÉ‡∏´‡πâ Luna ‡πÄ‡∏ï‡πâ‡∏ô (trigger emotion "hype" ‡πÉ‡∏ô VTS)
- `/luna mood` - ‡∏î‡∏π‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡πÅ‡∏™‡∏î‡∏á emotion + intensity)
- `/luna joke` - ‡πÄ‡∏•‡πà‡∏≤ joke ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (3 jokes)
- `/luna help` - ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ

### 2. **Caching System**
- Cache ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡πÉ‡∏ä‡πâ 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô key)
- TTL = 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 1000 entries
- ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ API ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß

### 3. **Natural Pauses**
- ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö (1-3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å
- ‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢ ‚Üí ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏¥‡∏î‡∏ô‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô (0.5-1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- Simulate thinking time ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏à‡∏£‡∏¥‡∏á

### 4. **Emotion Decay**
- ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏•‡∏î‡∏•‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ, rate 0.1)
- ‡∏ñ‡πâ‡∏≤ intensity < 0.2 ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô neutral
- ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (Emotion Duration)

### 5. **Emotion Continuity**
- ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏±‡∏Å‡∏û‡∏±‡∏Å (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
- ‡∏ñ‡πâ‡∏≤‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏£‡πá‡∏ß (< 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‚Üí 30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤ intensity > 0.8) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏î‡∏¥‡∏°

### 6. **Human-like Speech Patterns**
- **Word Repetition** (4-15% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™): "I think... I think it's really cool!"
- **Stutter** (2-8% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™): "Th-that's amazing!"
- **Emphasis (CAPS)** (12% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™, ‡πÄ‡∏°‡∏∑‡πà‡∏≠ hype/excited): "That's SO cool!"
- **Natural Response Length** (30% ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô): ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏¢‡∏≤‡∏ß > 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
- **Filler Words** (10-15%): "um", "uh", "like", "you know"
- **Self-correction** (5-10%): "Wait, actually...", "Hmm, let me think..."
- **Emojis** (10-15%): üòä, üéâ, üòÖ, üò¥, üí≠
- **Show Uncertainty** (10-15%): "I think", "maybe", "probably", "I'm not entirely sure"
- **Stop Mid-sentence** (5-10%): "I was thinking about... oh wait, did you see that message earlier?"
- **Casual Slang** (5-10%): "That's lit!", "No cap!", "That's sus", "That's fire"

### 7. **Social Connection Features**
- **Gratitude** (10-15%): "Thanks for watching!", "I really appreciate you being here!"
- **Celebrate** (10-15%): "Congratulations! That's amazing!", "Wow, that's so cool!"
- **Empathy** (15-20%): "I'm so sorry to hear that... I'm here for you"
- **Care** (10-15%): "Are you okay? I'm worried about you", "Take care of yourself, okay?"
- **Nicknames** (5+ conversations): "Hey there, {username}!", "What's up, {username}?"
- **Interest in Users' Lives** (10-15%, ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏ö‡πà‡∏≠‡∏¢): "How's your day going?", "What have you been up to?"
- **Surprise Reactions** (10-15%): "Oh my god! Really?!", "Wait, what?! That's incredible!"
- **Thank Users** (20-30% ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ): "Thanks for buying! That means a lot!"
- **Celebrate User Happiness** (15-20%): "I'm so happy you're happy!", "That's great! I'm glad to hear that!"

---

## üîß Configuration

### Environment Variables
```env
# AI API (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß)
OPENAI_KEY=sk-... (‡πÉ‡∏ä‡πâ OpenAI API)
OPENROUTER_KEY=sk-... (‡πÉ‡∏ä‡πâ OpenRouter API)

# Models
PRIMARY_MODEL=gpt-4o-mini (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß, ‡πÉ‡∏ä‡πâ SIMPLE_MODEL/COMPLEX_MODEL ‡πÅ‡∏ó‡∏ô)
SIMPLE_MODEL=gpt-4o-mini (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢)
COMPLEX_MODEL=anthropic/claude-3-opus (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å)
FALLBACK_MODEL=gpt-4o-mini (fallback ‡πÄ‡∏°‡∏∑‡πà‡∏≠ model ‡∏´‡∏•‡∏±‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß)

# TTS (ElevenLabs)
TTS_ENABLED=true (false = ‡∏õ‡∏¥‡∏î TTS)
ELEVEN_KEY=...
ELEVEN_VOICE_NORMAL=21m00Tcm4TlvDq8ikWAM (voice ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö normal)
ELEVEN_VOICE_SOFT=21m00Tcm4TlvDq8ikWAM (voice ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö soft)
ELEVEN_VOICE_PASSION=21m00Tcm4TlvDq8ikWAM (voice ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö passion)

# VTS (VTube Studio)
VTS_ENABLED=true (false = ‡∏õ‡∏¥‡∏î VTS)
VTS_HOST=127.0.0.1
VTS_PORT=8001
VTS_AUTH_TOKEN=... (‡∏£‡∏±‡∏ô 'node vts-auth.cjs' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠ token)

# Database
DB_DRIVER=sqlite (sqlite|postgres|none)
DB_SQLITE_PATH=tmp/luna.db (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SQLite)
DB_URL=postgresql://... (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Postgres)

# Server
PORT=8787
CORS_ORIGINS=* (‡∏´‡∏£‡∏∑‡∏≠ comma-separated list)

# Luna Token (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö RPS game)
LUNA_TOKEN_MINT=CbB4ivri6wLfqx4NwrWY3ArD7mXv1e91HeYeq3KBpump
```

---

## üìä Statistics

‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÉ‡∏ô `stats` object:
- **messages.total** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **messages.byUser** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Map<username, count>)
- **messages.byEmotion** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (Map<emotion, count>)
- **messages.byModel.simple** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ simple model
- **messages.byModel.complex** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ complex model
- **performance.totalResponseTime** - ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏ß‡∏° (ms)
- **performance.responseCount** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
- **performance.avgResponseTime** - ‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (ms)
- **performance.cacheHits** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô cache hits
- **performance.cacheMisses** - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô cache misses

---

## üêõ Error Handling

### Error Messages (Friendly)
- **Rate limit** (429) ‚Üí "Whoa, slow down there! I need a moment to catch up~ üòÖ"
- **Timeout** ‚Üí "Oops! That took too long. Let me try again~"
- **Network** ‚Üí "Hmm, something's wrong with the connection. Can you try again?"
- **API** (OpenAI/Claude error) ‚Üí "Oh no! I'm having trouble connecting right now. Please wait a moment~"
- **Validation** ‚Üí "Ehehe, I didn't quite understand that. Can you say it differently?"
- **Default** ‚Üí "Oops! Something went wrong. Let me try again~ üòä"

### Error Logging
- Log errors ‡∏•‡∏á console ‡∏û‡∏£‡πâ‡∏≠‡∏° context (endpoint, user, message)
- ‡πÉ‡∏ä‡πâ `logError()` function

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ

‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏¢ Luna ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô:

### ‚úÖ ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å
- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (angry, sad, sleepy, hype, soft)
- ‡∏à‡∏≥‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö (conversation history, preferences)
- ‡∏°‡∏µ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏≤‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (energy, sadness)
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (simple/complex)
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö TTS (ElevenLabs) ‡πÅ‡∏•‡∏∞ VTS (VTube Studio)
- ‡∏°‡∏µ WebSocket ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö real-time updates
- ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö cache ‡πÅ‡∏•‡∏∞ error handling
- ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ä‡∏ó‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á (chat reading system)
- Rate limiting (30 req/min)
- Natural pauses (thinking time)
- Human-like speech patterns (repetition, stutter, emphasis)
- Social connection features (gratitude, empathy, care)
- Memory decay (‡∏•‡∏∑‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤)
- Emotion continuity & decay
- Energy system (‡∏•‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡∏ô‡∏≤‡∏ô)

### üìä ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
- **Rate Limit**: 30 ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ï‡πà‡∏≠‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- **Cache TTL**: 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- **Max Message Length**: 1000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
- **Max Username Length**: 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
- **Emotion Duration**: 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- **Emotion Decay Interval**: 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- **Max Queue Size**: 50 ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- **Max Read Length**: 200 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
- **Max Cache Entries**: 1000 entries

### üîÑ Flow ‡∏™‡∏£‡∏∏‡∏õ
1. ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‚Üí Validate ‚Üí Custom Commands
2. Update Statistics ‚Üí Social Awareness ‚Üí Energy System
3. Physical Reactions ‚Üí Rate Limiting ‚Üí Chat Reading
4. Language Check ‚Üí Heuristic Check ‚Üí Think Before Respond
5. Cache Check ‚Üí Emotion Detection ‚Üí Model Selection
6. AI Response ‚Üí Emotion Continuity ‚Üí Natural Pauses
7. Reply Decoration ‚Üí Human-like Patterns ‚Üí Voice Selection
8. TTS Generation ‚Üí VTS Display ‚Üí Broadcast ‚Üí Response

---

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ `isEnglishOnly()`)
- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1000 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
- ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ OpenAI/OpenRouter API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ ElevenLabs API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö TTS
- ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ VTube Studio API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå JSON (memory, personality) ‡πÅ‡∏•‡∏∞ SQLite/Postgres (logs)
- WebSocket ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö real-time broadcasting
- Rate Limiting: 30 req/min ‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- Cache: 5 ‡∏ô‡∏≤‡∏ó‡∏µ TTL, ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 1000 entries

