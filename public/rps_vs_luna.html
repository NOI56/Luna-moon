<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luna Rock Paper Scissors - VS Luna</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', 'Monaco', monospace;
      background: #0a0a0a;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 0, 255, 0.1) 0%, transparent 50%),
        linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 50%, #16213e 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      color: #00ffff;
      position: relative;
      overflow: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(0, 255, 255, 0.03) 2px,
          rgba(0, 255, 255, 0.03) 4px
        );
      pointer-events: none;
      z-index: 0;
    }

    .game-container {
      position: relative;
      z-index: 1;
      text-align: center;
      max-width: 800px;
      width: 100%;
      padding-top: 100px;
      margin-top: 20px;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 20px;
      text-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff;
      color: #00ffff;
    }

    .wallet-section {
      margin-bottom: 30px;
    }

    .wallet-btn {
      background: rgba(0, 255, 255, 0.1);
      border: 2px solid #00ffff;
      color: #00ffff;
      padding: 12px 24px;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      margin: 5px;
      font-family: 'Courier New', monospace;
    }

    .wallet-btn:hover {
      background: rgba(0, 255, 255, 0.2);
      box-shadow: 0 0 20px #00ffff;
    }

    .wallet-btn.hidden {
      display: none;
    }

    .wallet-info {
      margin: 15px 0;
      padding: 10px;
      background: rgba(0, 255, 255, 0.05);
      border: 1px solid #00ffff;
      border-radius: 8px;
      font-size: 0.9rem;
    }

    .balance-check {
      margin: 15px 0;
      padding: 15px;
      border-radius: 8px;
      font-size: 1rem;
      border: 2px solid;
    }

    .balance-check.success {
      background: rgba(0, 255, 0, 0.1);
      border-color: #00ff00;
      color: #00ff00;
    }

    .balance-check.error {
      background: rgba(255, 0, 0, 0.1);
      border-color: #ff0000;
      color: #ff0000;
    }

    .balance-check.hidden {
      display: none;
    }

    .game-area {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 40px 0;
      gap: 20px;
    }

    .hand {
      text-align: center;
      flex: 1;
    }

    .hand-label {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff;
    }

    .hand-icon {
      width: 200px;
      height: 200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .hand-icon img {
      max-width: 100%;
      max-height: 100%;
      filter: drop-shadow(0 0 20px #00ffff);
    }

    #playerHand img {
      transform: scaleX(1) rotate(90deg);
    }

    #lunaHand img {
      transform: scaleX(1) rotate(-90deg);
    }

    .hand-icon.cycling img {
      animation: pulse 0.15s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .vs {
      font-size: 4rem;
      color: #00ffff;
      text-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff;
      font-weight: bold;
    }

    .player-choices {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }

    .choice-btn {
      width: 120px;
      height: 120px;
      background: rgba(0, 255, 255, 0.1);
      border: 3px solid #00ffff;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .choice-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .choice-btn:hover::before {
      opacity: 1;
    }

    .choice-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px #00ffff;
    }

    .choice-btn:active {
      transform: scale(0.95);
    }

    .choice-btn img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      position: relative;
      z-index: 1;
    }

    .choice-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .status {
      margin: 20px 0;
      font-size: 1.2rem;
      color: #00ffff;
      min-height: 30px;
    }

    .status.error {
      color: #ff0000;
    }

    .result {
      font-size: 2rem;
      margin: 20px 0;
      min-height: 50px;
      font-weight: bold;
    }

    .result.win {
      color: #00ff00;
      text-shadow: 0 0 20px #00ff00;
    }

    .result.lose {
      color: #ff0000;
      text-shadow: 0 0 20px #ff0000;
    }

    .result.tie {
      color: #ffff00;
      text-shadow: 0 0 20px #ffff00;
    }

    .countdown-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .countdown {
      font-size: 10rem;
      color: #00ffff;
      text-shadow: 0 0 50px #00ffff, 0 0 100px #00ffff;
      font-weight: bold;
      animation: pulse 1s infinite;
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #00ffff;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .back-link {
      /* Removed position/left/top to allow inline styles to work */
      color: #00ffff;
      text-decoration: none;
      padding: 10px 20px;
      border: 2px solid #00ffff;
      border-radius: 8px;
      transition: all 0.3s;
    }

    .back-link:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 20px #00ffff;
    }
    
    /* Ensure mode navigation is always visible */
    #modeNavigation {
      position: fixed !important;
      top: 20px !important;
      left: 20px !important;
      z-index: 99999 !important;
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    #modeNavigation a {
      display: inline-block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
  </style>
</head>
<body>
  <div id="modeNavigation" style="position: fixed !important; top: 20px !important; left: 20px !important; display: flex !important; gap: 10px; z-index: 99999 !important; flex-wrap: wrap; pointer-events: auto !important; visibility: visible !important; opacity: 1 !important;">
    <a href="/rps_game.html" id="pvpLink" style="color: #00ffff !important; text-decoration: none !important; padding: 10px 20px !important; border: 2px solid #00ffff !important; border-radius: 8px !important; transition: all 0.3s; background: rgba(0, 0, 0, 0.9) !important; backdrop-filter: blur(5px); display: inline-block !important; visibility: visible !important; opacity: 1 !important;">‚Üê PvP Mode</a>
    <a href="/rps_betting.html" id="bettingLink" style="color: #ff00ff !important; text-decoration: none !important; padding: 10px 20px !important; border: 2px solid #ff00ff !important; border-radius: 8px !important; transition: all 0.3s; background: rgba(0, 0, 0, 0.9) !important; backdrop-filter: blur(5px); display: inline-block !important; visibility: visible !important; opacity: 1 !important;">üí∞ Betting Mode</a>
  </div>

  <div class="game-container">
    <h1>üéÆ VS Luna</h1>

    <div class="wallet-section">
      <button id="connectWalletBtn" class="wallet-btn">üîó Connect Phantom Wallet</button>
      <button id="disconnectWalletBtn" class="wallet-btn hidden">üîå Disconnect / Change Wallet</button>
      <div id="walletInfo" class="wallet-info hidden"></div>
      <div id="balanceCheck" class="balance-check hidden"></div>
    </div>

    <div class="game-area">
      <div class="hand">
        <div class="hand-label">You</div>
        <div id="playerHand" class="hand-icon"></div>
      </div>
      <div class="vs">VS</div>
      <div class="hand">
        <div class="hand-label">Luna</div>
        <div id="lunaHand" class="hand-icon"></div>
      </div>
    </div>

    <div id="result" class="result"></div>

    <div class="controls">
      <div class="player-choices">
        <button class="choice-btn" data-choice="rock" id="rockBtn"></button>
        <button class="choice-btn" data-choice="paper" id="paperBtn"></button>
        <button class="choice-btn" data-choice="scissors" id="scissorsBtn"></button>
      </div>
      <div id="status" class="status"></div>
    </div>
    
    <div style="margin-top: 40px; text-align: center;">
      <a href="/rps_betting.html" style="color: #ff00ff; text-decoration: none; padding: 15px 30px; border: 2px solid #ff00ff; border-radius: 8px; transition: all 0.3s; display: inline-block; font-size: 1.1em;">üí∞ Betting Mode</a>
    </div>
  </div>

  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script>
    const API_BASE = window.location.origin;
    const RPS_MIN_BALANCE = 1000000; // 1M Luna tokens
    // Mint address ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å backend (.env) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á hardcode ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
    
    let playerBalance = 0;
    let gameActive = false;
    let walletConnected = false;
    let walletPublicKey = null;

    // Real-time balance checking enabled
    const TEST_MODE = false; // Using real Luna token
    let balanceUpdateInterval = null;

    // Hand images
    const HAND_IMAGES = {
      rock: '/public/images/hands/rock.png',
      paper: '/public/images/hands/paper.png',
      scissors: '/public/images/hands/scissors.png',
      default: '/public/images/hands/rock.png'
    };
    
    const HAND_EMOJIS = {
      rock: 'ü™®',
      paper: 'üìÑ',
      scissors: '‚úÇÔ∏è',
      default: 'üëã'
    };
    
    function getHandDisplay(choice) {
      const img = document.createElement('img');
      img.src = HAND_IMAGES[choice] || HAND_IMAGES.default;
      img.alt = choice || 'default';
      img.onerror = function() {
        this.parentElement.textContent = HAND_EMOJIS[choice] || HAND_EMOJIS.default;
      };
      return img;
    }

    function formatNumber(num) {
      if (num >= 1000000) {
        return (num / 1000000).toFixed(2) + 'M';
      } else if (num >= 1000) {
        return (num / 1000).toFixed(2) + 'K';
      }
      return num.toString();
    }

    // Check Luna Token Balance
    async function checkLunaBalance() {
      const balanceCheck = document.getElementById('balanceCheck');
      if (!balanceCheck) return;
      
      balanceCheck.classList.remove('hidden');
      balanceCheck.className = 'balance-check';
      balanceCheck.innerHTML = '<span class="loading"></span> Checking balance...';

      if (!walletConnected || !walletPublicKey) {
        balanceCheck.className = 'balance-check error';
        balanceCheck.textContent = '‚ùå Please connect your Phantom wallet first!';
        disableGame();
        return;
      }

      // Check real balance from blockchain
      // Mint address ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å backend (.env) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      try {
        // Use backend API to check balance (bypasses RPC rate limiting)
        // Backend ‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô mint address ‡∏à‡∏≤‡∏Å .env ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        const response = await fetch(`${API_BASE}/luna/rps/balance?wallet=${walletPublicKey}`);
        const data = await response.json();
        
        if (!data.ok) {
          throw new Error(data.error || 'Failed to check balance');
        }
        
        playerBalance = data.balance || 0;

        if (playerBalance >= RPS_MIN_BALANCE) {
          balanceCheck.className = 'balance-check success';
          balanceCheck.textContent = `‚úÖ Balance: ${formatNumber(playerBalance)} Luna (Ready to play!)`;
          enableGame();
        } else {
          balanceCheck.className = 'balance-check error';
          balanceCheck.textContent = `‚ùå Insufficient balance! You need at least ${formatNumber(RPS_MIN_BALANCE)} Luna tokens. Current: ${formatNumber(playerBalance)}`;
          disableGame();
        }
      } catch (error) {
        console.error('Balance check error:', error);
        balanceCheck.className = 'balance-check error';
        balanceCheck.textContent = `‚ùå Error checking balance: ${error.message}`;
        disableGame();
      }
    }

    // Start real-time balance updates
    function startBalanceUpdate() {
      // Clear existing interval if any
      if (balanceUpdateInterval) {
        clearInterval(balanceUpdateInterval);
      }
      
      // Update balance every 15 seconds (reduced frequency to avoid rate limiting)
      balanceUpdateInterval = setInterval(async () => {
        if (walletConnected && walletPublicKey) {
          await checkLunaBalance();
        }
      }, 15000);
    }

    // Stop real-time balance updates
    function stopBalanceUpdate() {
      if (balanceUpdateInterval) {
        clearInterval(balanceUpdateInterval);
        balanceUpdateInterval = null;
      }
    }

    function enableGame() {
      gameActive = true;
      document.querySelectorAll('.choice-btn').forEach(btn => {
        btn.classList.remove('disabled');
        btn.disabled = false;
      });
    }

    function disableGame() {
      gameActive = false;
      document.querySelectorAll('.choice-btn').forEach(btn => {
        btn.classList.add('disabled');
        btn.disabled = true;
      });
    }

    // Phantom Wallet Connection
    function setupWalletConnection() {
      const connectBtn = document.getElementById('connectWalletBtn');
      const disconnectBtn = document.getElementById('disconnectWalletBtn');
      const walletInfo = document.getElementById('walletInfo');
      
      if (!connectBtn) {
        console.error('[VS Luna] connectWalletBtn not found!');
        return;
      }

      if (!disconnectBtn) {
        console.error('[VS Luna] disconnectWalletBtn not found!');
        return;
      }
      
      // Check if Phantom wallet is available
      if (typeof window.solana === 'undefined' || !window.solana.isPhantom) {
        connectBtn.textContent = '‚ö†Ô∏è Phantom Wallet not found!';
        connectBtn.disabled = true;
        connectBtn.style.cursor = 'not-allowed';
        connectBtn.onclick = () => {
          alert('Please install Phantom wallet extension!\n\nDownload: https://phantom.app/');
        };
        return;
      }

      // Enable button
      connectBtn.disabled = false;
      connectBtn.style.cursor = 'pointer';
      
      connectBtn.addEventListener('click', async () => {
        try {
          if (!window.solana || !window.solana.isPhantom) {
            alert('Please install Phantom wallet extension!\n\nDownload: https://phantom.app/');
            return;
          }

          const response = await window.solana.connect();
          walletPublicKey = response.publicKey.toString();
          walletConnected = true;

          connectBtn.classList.add('hidden');
          disconnectBtn.classList.remove('hidden');
          walletInfo.textContent = `Wallet: ${walletPublicKey.substring(0, 8)}...${walletPublicKey.substring(walletPublicKey.length - 8)}`;
          walletInfo.classList.remove('hidden');

          await checkLunaBalance();
          startBalanceUpdate(); // Start real-time balance updates
        } catch (error) {
          console.error('Wallet connection error:', error);
          alert('Failed to connect wallet: ' + error.message);
        }
      });

      disconnectBtn.addEventListener('click', async () => {
        try {
          if (window.solana && window.solana.isConnected) {
            await window.solana.disconnect();
          }
          
          walletPublicKey = null;
          walletConnected = false;
          playerBalance = 0;
          gameActive = false;

          stopBalanceUpdate(); // Stop real-time balance updates

          connectBtn.classList.remove('hidden');
          disconnectBtn.classList.add('hidden');
          walletInfo.classList.add('hidden');
          
          const balanceCheck = document.getElementById('balanceCheck');
          if (balanceCheck) {
            balanceCheck.classList.add('hidden');
          }
          
          disableGame();
        } catch (error) {
          console.error('Wallet disconnect error:', error);
          walletPublicKey = null;
          walletConnected = false;
          playerBalance = 0;
          connectBtn.classList.remove('hidden');
          disconnectBtn.classList.add('hidden');
          walletInfo.classList.add('hidden');
          disableGame();
        }
      });

      if (window.solana && window.solana.isPhantom) {
        window.solana.on('connect', async () => {
          walletPublicKey = window.solana.publicKey.toString();
          walletConnected = true;
          connectBtn.classList.add('hidden');
          disconnectBtn.classList.remove('hidden');
          walletInfo.textContent = `Wallet: ${walletPublicKey.substring(0, 8)}...${walletPublicKey.substring(walletPublicKey.length - 8)}`;
          walletInfo.classList.remove('hidden');
          await checkLunaBalance();
          startBalanceUpdate(); // Start real-time balance updates
          startBalanceUpdate(); // Start real-time balance updates
        });

        window.solana.on('disconnect', () => {
          stopBalanceUpdate(); // Stop real-time balance updates
          walletPublicKey = null;
          walletConnected = false;
          playerBalance = 0;
          connectBtn.classList.remove('hidden');
          disconnectBtn.classList.add('hidden');
          walletInfo.classList.add('hidden');
          disableGame();
        });

        if (window.solana.isConnected) {
          walletPublicKey = window.solana.publicKey.toString();
          walletConnected = true;
          connectBtn.classList.add('hidden');
          disconnectBtn.classList.remove('hidden');
          walletInfo.textContent = `Wallet: ${walletPublicKey.substring(0, 8)}...${walletPublicKey.substring(walletPublicKey.length - 8)}`;
          walletInfo.classList.remove('hidden');
          checkLunaBalance();
        }
      }
    }

    // Initialize hands
    function initializeHands() {
      const playerHand = document.getElementById('playerHand');
      const lunaHand = document.getElementById('lunaHand');
      const rockBtn = document.getElementById('rockBtn');
      const paperBtn = document.getElementById('paperBtn');
      const scissorsBtn = document.getElementById('scissorsBtn');
      
      playerHand.appendChild(getHandDisplay('rock'));
      lunaHand.appendChild(getHandDisplay('rock'));
      
      if (rockBtn) {
        rockBtn.innerHTML = '';
        rockBtn.appendChild(getHandDisplay('rock'));
      }
      if (paperBtn) {
        paperBtn.innerHTML = '';
        paperBtn.appendChild(getHandDisplay('paper'));
      }
      if (scissorsBtn) {
        scissorsBtn.innerHTML = '';
        scissorsBtn.appendChild(getHandDisplay('scissors'));
      }
    }

    // Hand cycling animation
    let handCycleInterval = null;
    const handChoices = ['rock', 'paper', 'scissors'];
    let currentCycleIndex = 0;
    
    function startHandCycle(handElement) {
      if (handCycleInterval) {
        clearInterval(handCycleInterval);
      }
      
      currentCycleIndex = 0;
      handElement.classList.add('cycling');
      handCycleInterval = setInterval(() => {
        const choice = handChoices[currentCycleIndex];
        handElement.innerHTML = '';
        handElement.appendChild(getHandDisplay(choice));
        currentCycleIndex = (currentCycleIndex + 1) % handChoices.length;
      }, 150);
    }
    
    function stopHandCycle() {
      if (handCycleInterval) {
        clearInterval(handCycleInterval);
        handCycleInterval = null;
      }
    }

    // Play game with Luna
    async function playGame(playerChoice) {
      if (!gameActive) return;
      
      if (!walletConnected || !walletPublicKey) {
        const status = document.getElementById('status');
        status.textContent = 'Please connect your Phantom wallet first!';
        status.className = 'status error';
        return;
      }
      
      if (playerBalance < RPS_MIN_BALANCE) {
        const status = document.getElementById('status');
        status.textContent = `Insufficient balance! You need at least ${formatNumber(RPS_MIN_BALANCE)} Luna tokens.`;
        status.className = 'status error';
        await checkLunaBalance();
        return;
      }

      const status = document.getElementById('status');
      const result = document.getElementById('result');
      const playerHand = document.getElementById('playerHand');
      const lunaHand = document.getElementById('lunaHand');

      disableGame();
      status.textContent = '';
      result.textContent = '';

      playerHand.innerHTML = '';
      playerHand.appendChild(getHandDisplay(playerChoice));
      playerHand.classList.remove('animate', 'cycling');

      lunaHand.classList.add('cycling');
      startHandCycle(lunaHand);

      // Countdown 3-2-1
      const countdownOverlay = document.createElement('div');
      countdownOverlay.className = 'countdown-overlay';
      document.body.appendChild(countdownOverlay);

      const countdownNumbers = [3, 2, 1];
      let countdownIndex = 0;

      const showCountdown = () => {
        if (countdownIndex < countdownNumbers.length) {
          const countdownText = document.createElement('div');
          countdownText.className = 'countdown';
          countdownText.textContent = countdownNumbers[countdownIndex];
          countdownOverlay.innerHTML = '';
          countdownOverlay.appendChild(countdownText);
          countdownIndex++;
          setTimeout(showCountdown, 1000);
        } else {
          countdownOverlay.remove();
          continueGame(playerChoice, playerHand, lunaHand, status, result);
        }
      };

      showCountdown();
    }

    async function continueGame(playerChoice, playerHand, lunaHand, status, result) {
      stopHandCycle();
      
      try {
        const response = await fetch(`${API_BASE}/luna/rps/play`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            wallet: walletPublicKey || 'guest',
            choice: playerChoice,
            testMode: TEST_MODE // Send test mode flag to server
          })
        });

        const data = await response.json();
        
        if (!data.ok) {
          throw new Error(data.message || 'Game failed');
        }

        const lunaChoice = data.lunaChoice;
        lunaHand.innerHTML = '';
        lunaHand.appendChild(getHandDisplay(lunaChoice));
        lunaHand.classList.remove('cycling', 'animate');

        let finalResult = '';
        if (data.result === 'win') {
          finalResult = 'üéâ You Win!';
          result.className = 'result win';
          status.textContent = `Luna chose ${lunaChoice}. You win!`;
        } else if (data.result === 'lose') {
          finalResult = 'üò¢ You Lose!';
          result.className = 'result lose';
          status.textContent = `Luna chose ${lunaChoice}. You lose!`;
        } else {
          finalResult = 'ü§ù Tie!';
          result.className = 'result tie';
          status.textContent = `Both chose ${lunaChoice}. It's a tie!`;
        }
        result.textContent = finalResult;

        setTimeout(() => {
          enableGame();
          status.textContent = '';
          result.textContent = '';
          playerHand.innerHTML = '';
          playerHand.appendChild(getHandDisplay('rock'));
          lunaHand.innerHTML = '';
          lunaHand.appendChild(getHandDisplay('rock'));
        }, 3000);
      } catch (error) {
        console.error('Play game error:', error);
        stopHandCycle();
        status.textContent = `Error: ${error.message}`;
        status.className = 'status error';
        enableGame();
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      document.querySelectorAll('.choice-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          if (!gameActive || btn.classList.contains('disabled')) return;
          
          const choice = btn.dataset.choice;
          await playGame(choice);
        });
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      setupWalletConnection();
      setupEventListeners();
      initializeHands();
    });
  </script>
</body>
</html>

